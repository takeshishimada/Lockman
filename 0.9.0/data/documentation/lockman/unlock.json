{"sections":[],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Lockman\/documentation\/Lockman\/Unlock"},"kind":"article","seeAlsoSections":[{"identifiers":["doc:\/\/Lockman\/documentation\/Lockman\/GettingStarted","doc:\/\/Lockman\/documentation\/Lockman\/BoundaryOverview","doc:\/\/Lockman\/documentation\/Lockman\/Lock","doc:\/\/Lockman\/documentation\/Lockman\/ChoosingStrategy","doc:\/\/Lockman\/documentation\/Lockman\/Configuration","doc:\/\/Lockman\/documentation\/Lockman\/ErrorHandling","doc:\/\/Lockman\/documentation\/Lockman\/DebuggingGuide"],"title":"Essentials","anchor":"Essentials","generated":true}],"variants":[{"paths":["\/documentation\/lockman\/unlock"],"traits":[{"interfaceLanguage":"swift"}]}],"hierarchy":{"paths":[["doc:\/\/Lockman\/documentation\/Lockman"]]},"metadata":{"role":"article","title":"Unlock","modules":[{"name":"Lockman"}],"roleHeading":"Article"},"schemaVersion":{"patch":0,"major":0,"minor":3},"abstract":[{"type":"text","text":"Understanding the unlocking mechanism in Lockman."}],"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","anchor":"Overview","level":2,"type":"heading"},{"inlineContent":[{"text":"Unlocking in Lockman is a mechanism for properly releasing acquired locks. It ensures resource release and maintains system consistency in all situations, including after processing completion, error occurrence, or cancellation.","type":"text"}],"type":"paragraph"},{"text":"Specifications","anchor":"Specifications","level":2,"type":"heading"},{"text":"Automatic Release","anchor":"Automatic-Release","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"In the auto-release version of "},{"overridingTitleInlineContent":[{"type":"text","text":"withLock"}],"identifier":"doc:\/\/Lockman\/documentation\/Lockman\/Lock","isActive":true,"type":"reference","overridingTitle":"withLock"},{"type":"text","text":", locks are automatically released at the following timings:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"On normal completion"}]},{"text":": When processing completes normally","type":"text"}]}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"On exception","type":"text"}],"type":"strong"},{"type":"text","text":": When an error occurs"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"On cancellation"}]},{"text":": When processing is cancelled","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"text":"On early return","type":"text"}],"type":"strong"},{"text":": When processing ends prematurely","type":"text"}]}]}],"type":"unorderedList"},{"inlineContent":[{"text":"Automatic release is implemented using defer blocks, ensuring that locks are reliably released regardless of the termination pattern.","type":"text"}],"type":"paragraph"},{"text":"Manual Release","anchor":"Manual-Release","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"In the manual release version of "},{"type":"reference","overridingTitleInlineContent":[{"text":"withLock","type":"text"}],"isActive":true,"overridingTitle":"withLock","identifier":"doc:\/\/Lockman\/documentation\/Lockman\/Lock"},{"type":"text","text":", developers explicitly call the unlock() function to release locks."}],"type":"paragraph"},{"inlineContent":[{"inlineContent":[{"text":"Important constraints:","type":"text"}],"type":"strong"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"You must call unlock() in all code paths","type":"text"}]}]},{"content":[{"inlineContent":[{"text":"Forgetting to call unlock() causes permanent lock acquisition state","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Proper release is necessary even in conditional branches and error handling"}]}]}],"type":"unorderedList"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Unlock object characteristics:","type":"text"}]}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Conforms to the Sendable protocol, allowing it to be passed when calling other actions"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Designed for use across multiple screens and actions"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Enables shared lock state and coordinated release between actions"}]}]}],"type":"unorderedList"},{"text":"Release Options","anchor":"Release-Options","level":3,"type":"heading"},{"inlineContent":[{"text":"Unlock execution timing can be controlled with LockmanUnlockOption:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"immediate"}]},{"text":": Release immediately upon processing completion","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"text":"mainRunLoop","type":"text"}]},{"type":"text","text":": Release in the next main run loop cycle"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"transition","type":"text"}]},{"text":": Release after platform-specific screen transition animation completion","type":"text"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"iOS: 0.35 seconds (push\/pop animation)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"macOS: 0.25 seconds (window and view animation)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"tvOS: 0.4 seconds (focus-driven transition)","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"watchOS: 0.3 seconds (page-based navigation)"}],"type":"paragraph"}]}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"text":"delayed(TimeInterval)","type":"text"}]},{"text":": Release after specified time","type":"text"}]}]}],"type":"unorderedList"},{"text":"Methods","type":"heading","level":2,"anchor":"Methods"},{"text":"Auto-release Usage Example","level":3,"anchor":"Auto-release-Usage-Example","type":"heading"},{"code":[".withLock(","  operation: { send in","    \/\/ Execute processing","    try await someAsyncWork()","    send(.completed)","    \/\/ Lock is automatically released here","  },","  catch handler: { error, send in","    \/\/ Automatically released after error handling","    send(.failed(error))","  },","  action: action,","  cancelID: cancelID",")"],"syntax":"swift","type":"codeListing"},{"text":"Manual Release Usage Example","level":3,"anchor":"Manual-Release-Usage-Example","type":"heading"},{"inlineContent":[{"type":"text","text":"Basic usage example:"}],"type":"paragraph"},{"code":[".withLock(","  operation: { send, unlock in","    try await firstOperation()","    ","    if shouldEarlyReturn {","      unlock() \/\/ Early release","      return","    }","    ","    try await secondOperation()","    unlock() \/\/ Required: Final release","  },","  catch handler: { error, send, unlock in","    \/\/ Error handling","    unlock() \/\/ Release on error too","    send(.failed(error))","  },","  action: action,","  cancelID: cancelID",")"],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"text","text":"Example of release in another screen’s delegate:"}],"type":"paragraph"},{"code":[".withLock(","  operation: { send, unlock in","    \/\/ Pass unlock object to another screen and transition","    send(.delegate(unlock: unlock))","  },","  action: action,","  cancelID: cancelID",")","","\/\/ Receive and release on the delegate side","case .modal(.delegate(let unlock)):","  return .run { send in","    \/\/ Release after modal processing completion","    unlock()","  }"],"syntax":"swift","type":"codeListing"}]}],"references":{"doc://Lockman/documentation/Lockman/DebuggingGuide":{"kind":"article","title":"Debugging Guide","url":"\/documentation\/lockman\/debuggingguide","identifier":"doc:\/\/Lockman\/documentation\/Lockman\/DebuggingGuide","role":"article","type":"topic","abstract":[{"type":"text","text":"Learn how to debug Lockman-related issues in your application."}]},"doc://Lockman/documentation/Lockman":{"identifier":"doc:\/\/Lockman\/documentation\/Lockman","kind":"symbol","type":"topic","title":"Lockman","url":"\/documentation\/lockman","abstract":[{"type":"text","text":"A library to implement exclusive control of user actions in application development using TCA."}],"role":"collection"},"doc://Lockman/documentation/Lockman/ErrorHandling":{"role":"article","kind":"article","type":"topic","url":"\/documentation\/lockman\/errorhandling","title":"Error Handling","abstract":[{"text":"Learn about common error handling patterns in Lockman.","type":"text"}],"identifier":"doc:\/\/Lockman\/documentation\/Lockman\/ErrorHandling"},"doc://Lockman/documentation/Lockman/Configuration":{"title":"Configuration","identifier":"doc:\/\/Lockman\/documentation\/Lockman\/Configuration","url":"\/documentation\/lockman\/configuration","role":"article","kind":"article","abstract":[{"text":"Configure Lockman for your application’s needs.","type":"text"}],"type":"topic"},"doc://Lockman/documentation/Lockman/ChoosingStrategy":{"abstract":[{"text":"Learn how to select the right strategy for your use case.","type":"text"}],"url":"\/documentation\/lockman\/choosingstrategy","title":"Choosing a Strategy","role":"article","kind":"article","type":"topic","identifier":"doc:\/\/Lockman\/documentation\/Lockman\/ChoosingStrategy"},"doc://Lockman/documentation/Lockman/Lock":{"type":"topic","title":"Lock","abstract":[{"type":"text","text":"Understanding the locking mechanism in Lockman."}],"url":"\/documentation\/lockman\/lock","role":"article","kind":"article","identifier":"doc:\/\/Lockman\/documentation\/Lockman\/Lock"},"doc://Lockman/documentation/Lockman/GettingStarted":{"title":"Getting Started","kind":"article","url":"\/documentation\/lockman\/gettingstarted","identifier":"doc:\/\/Lockman\/documentation\/Lockman\/GettingStarted","role":"article","type":"topic","abstract":[{"type":"text","text":"Learn how to integrate Lockman into your TCA application."}]},"doc://Lockman/documentation/Lockman/BoundaryOverview":{"title":"Boundary","identifier":"doc:\/\/Lockman\/documentation\/Lockman\/BoundaryOverview","role":"article","type":"topic","abstract":[{"type":"text","text":"Understand the concept of boundaries in Lockman."}],"kind":"article","url":"\/documentation\/lockman\/boundaryoverview"}}}